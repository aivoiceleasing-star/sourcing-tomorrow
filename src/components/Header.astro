---
import { SignedIn, SignedOut, UserButton } from '@clerk/astro/components';

const currentPath = Astro.url.pathname;

const navLinks = [
  { label: 'Articles', href: '/articles/' },
  { label: 'Tools', href: '/tools/' },
  { label: 'Resources', href: '/resources/' },
  { label: 'Newsletter', href: '/newsletter/' },
  { label: 'About', href: '/about/' },
];

function isActive(href: string): boolean {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
}
---

<header class="fixed top-0 left-0 right-0 z-50 bg-white border-b border-neutral-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center h-36 lg:h-48">
      <!-- Logo -->
      <a href="/" class="flex-shrink-0">
        <img src="/images/logo.webp" alt="SourcingTomorrow" class="h-36 lg:h-44 w-auto" />
      </a>

      <!-- Desktop Navigation (centered) -->
      <nav class="hidden lg:flex items-center justify-center gap-14 flex-1">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'text-sm font-medium transition-colors duration-200',
              isActive(link.href)
                ? 'text-brand-700'
                : 'text-neutral-600 hover:text-brand-700',
            ]}
          >
            {link.label}
          </a>
        ))}
      </nav>

      <!-- Desktop Auth Buttons -->
      <div class="hidden lg:flex items-center gap-3 flex-shrink-0">
        <SignedOut>
          <a
            href="/sign-in/"
            class="text-sm font-medium text-neutral-600 hover:text-brand-700 transition-colors duration-200"
          >
            Sign in
          </a>
          <a
            href="/sign-up/"
            class="btn-primary px-5 py-2.5 text-sm"
          >
            Get started
          </a>
        </SignedOut>
        <SignedIn>
          <UserButton />
        </SignedIn>
      </div>

      <!-- Mobile Hamburger Button -->
      <button
        type="button"
        id="mobile-menu-button"
        class="lg:hidden ml-auto flex items-center justify-center w-10 h-10 rounded-lg text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 transition-colors duration-200"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <svg id="menu-icon-open" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg id="menu-icon-close" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden lg:hidden border-t border-neutral-200 bg-white">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex flex-col gap-1">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class:list={[
            'block px-4 py-3 rounded-lg text-sm font-medium transition-colors duration-200',
            isActive(link.href)
              ? 'text-brand-700 bg-brand-50'
              : 'text-neutral-600 hover:text-brand-700 hover:bg-neutral-50',
          ]}
        >
          {link.label}
        </a>
      ))}
      <!-- Mobile Auth -->
      <div class="mt-3 pt-3 border-t border-neutral-200 flex flex-col gap-2 px-4">
        <SignedOut>
          <a
            href="/sign-in/"
            class="block py-3 text-sm font-medium text-neutral-600 hover:text-brand-700 transition-colors duration-200"
          >
            Sign in
          </a>
          <a
            href="/sign-up/"
            class="btn-primary px-5 py-3 text-sm text-center"
          >
            Get started
          </a>
        </SignedOut>
        <SignedIn>
          <div class="py-2">
            <UserButton />
          </div>
        </SignedIn>
      </div>
    </nav>
  </div>
</header>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  button?.addEventListener('click', () => {
    const isExpanded = button.getAttribute('aria-expanded') === 'true';
    button.setAttribute('aria-expanded', String(!isExpanded));
    menu?.classList.toggle('hidden');
    iconOpen?.classList.toggle('hidden');
    iconClose?.classList.toggle('hidden');
  });
</script>
